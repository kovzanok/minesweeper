!function(){"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),function(){var t;e.g.importScripts&&(t=e.g.location+"");var n=e.g.document;if(!t&&n&&(n.currentScript&&(t=n.currentScript.src),!t)){var s=n.getElementsByTagName("script");if(s.length)for(var a=s.length-1;a>-1&&!t;)t=s[a--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t}();class t{static renderContainer(){const e=document.createElement("div");return e.className="container",e}}function n(e){return e[0].toUpperCase()+e.slice(1)}function s(e){return e.includes("easy")?"easy":e.includes("medium")?"medium":"hard"}function a(){return[document.getElementById("time").textContent,document.getElementById("moves").textContent]}var i=e.p+"assets/flagMode.mp3";class r{static renderModal(){const e=document.createElement("div");e.addEventListener("click",r.removeModal),e.className="modal",window.dispatchEvent(new Event("timerPause"));const t=document.createElement("div");return t.className="modal__body",e.append(t),e}static removeModal(e){e.target.classList.contains("modal__body")||e.target.closest(".modal__body")||(window.dispatchEvent(new Event("timerGo")),e.target.remove())}}class o{constructor(e="medium"){this.difficulty=e,this.difficulties=["easy","medium","hard"]}renderDifficultiesBlock(){const e=document.createElement("div");e.className="difficulty-block",e.append("Change difficulty:");const t=this.renderDifficultiesList(),n=o.renderMinesNumberInput();return e.append(t,n),e}renderDifficultiesList(){const e=document.createElement("ul");return e.className="difficulty-list",this.difficulties.forEach((t=>{const n=this.renderDifficultyListItem(t);e.append(n)})),e.addEventListener("click",o.changeDifficulties),e}renderDifficultyListItem(e){const t=document.createElement("li");t.className="difficulty";const s=document.createElement("button");return s.className="button "+(e===this.difficulty?"button_active":""),s.setAttribute("data-difficulty",e),s.textContent=n(e),t.append(s),t}static renderMinesNumberInput(){const e=document.createElement("input");e.className="mines-input",e.id="mines",e.type="number",e.min=10,e.max=99,e.value=10,e.addEventListener("input",o.validateNumberInput),e.addEventListener("change",o.insertMinValue);const t=document.createElement("label");return t.for="mines",t.textContent="Mines:",t.append(e),t}static validateNumberInput(e){const t=e.target;t.value.length>=3&&(t.value=t.value.slice(0,2))}static insertMinValue(e){const t=e.target;Number(t.value)<=9&&(t.value=10)}static changeDifficulties(e){e.target.classList.contains("button")&&(e.target.closest("ul").querySelector(".button_active").classList.remove("button_active"),e.target.classList.add("button_active"))}}class c extends r{static render(){const e=r.renderModal(),t=c.renderContent(),n=c.renderNewGameButton();return n.addEventListener("click",c.startNewGame),e.querySelector(".modal__body").append(t,n),e}static renderContent(){return(new o).renderDifficultiesBlock()}static renderNewGameButton(){const e=document.createElement("button");return e.className="button button_new-game",e.textContent="Start game",e}static startNewGame(e){const t=e.target.closest(".modal__body"),[n,s]=c.getDataFromModalBody(t),a=new CustomEvent("newGame",{detail:[n,s]});window.dispatchEvent(a)}static getDataFromModalBody(e){const{difficulty:t}=e.querySelector(".button_active").dataset;return[t,Number(e.querySelector("input").value)]}}class d extends r{static render(e){const t=r.renderModal(),n=d.renderContent(e),s=d.renderBackButton();return s.addEventListener("click",(()=>{window.dispatchEvent(new Event("timerGo")),t.remove()})),t.querySelector(".modal__body").append(n,s),t}static renderBackButton(){const e=document.createElement("button");return e.className="button button_back",e.textContent="Back",e}static renderContent(){const e=JSON.parse(localStorage.getItem("savedResults")||"[]");e.reverse();const t=document.createElement("table"),n=document.createElement("thead");return["â„–","Time","Mines","Difficulty","Moves"].forEach((e=>{const t=document.createElement("th");t.textContent=e,n.append(t)})),t.append(n),t.className="modal-table",e.forEach(((e,n)=>{const s=document.createElement("tr"),a=document.createElement("td");a.textContent=`${n+1}.`,s.append(a),Object.values(e).forEach(((e,t)=>{const n=document.createElement("td");n.textContent=0===t?`${e}s`:e,s.append(n)})),t.append(s)})),t}}class l{static isMuted=!1;static renderBackground(){const e=document.createElement("div");return e.className="background-controls",e.addEventListener("click",l.hidemenu),e}static hidemenu(e){document.querySelector(".controls-wrapper").classList.remove("controls-wrapper_active"),e.target.remove()}static renderControls(){const e=document.createElement("div");e.className="controls-wrapper";const t=document.createElement("ul");return t.className="controls",["restart","save","latest-10","toggle","new game","sound"].forEach((e=>{const n=l.renderControl(e);"toggle"===e?n.addEventListener("click",l.toggleTheme):"new game"===e?n.addEventListener("click",l.displayNewGameModal):"restart"===e?n.addEventListener("click",l.restartGame):"sound"===e?n.addEventListener("click",l.toggleSound):"save"===e?n.addEventListener("click",l.saveGame):"latest-10"===e&&n.addEventListener("click",l.showResults),t.append(n)})),e.append(t),e}static renderControl(e){const t=document.createElement("li");t.className="control";const s=document.createElement("button");return s.className="button button_control",s.setAttribute("data-action",e),s.textContent="sound"===e?`${n(e)}: ${l.isMuted?"Off":"On"}`:n(e),t.append(s),t}static toggleTheme(){const e=document.body.classList.toggle("light-theme");window.localStorage.setItem("isLightTheme",e)}static displayNewGameModal(){const e=c.render();document.body.append(e)}static restartGame(){const e=document.getElementById("field"),t=s(e.classList.toString()),n=Array.from(e.querySelectorAll(".cell")).reduce(((e,t)=>"B"===t.textContent?e+1:e+0),0)||Number(document.getElementById("mines-left").textContent),a=new CustomEvent("restart",{detail:[t,n]});window.dispatchEvent(a)}static toggleSound(){l.isMuted=!l.isMuted,document.body.querySelector('[data-action="sound"]').textContent="Sound: "+(l.isMuted?"Off":"On")}static saveGame(e){const t=e.target;l.saveDifficulty(),l.saveMines(),l.saveField(),t.textContent="Saving",t.disabled=!0,setTimeout((()=>{t.textContent="Save",t.disabled=!1}),500)}static saveDifficulty(){const e=s(document.getElementById("field").classList.toString());window.localStorage.setItem("difficultyValue",e)}static saveMines(){const e=document.getElementById("field"),t=Array.from(e.querySelectorAll(".cell")).reduce(((e,t)=>"B"===t.textContent?e+1:e+0),0)||Number(document.getElementById("mines-left").textContent);window.localStorage.setItem("minesCountValue",t)}static saveField(){const[e,t]=a(),n={cells:[],minesLeft:0,time:e,moves:t},s=document.getElementById("field"),i=Array.from(s.querySelectorAll(".cell"));i.every((e=>""===e.textContent))||i.forEach((e=>{"flag"===e.dataset.status&&(n.minesLeft+=1),n.cells.push({id:e.id,status:e.dataset.status,coord:e.dataset.coord,className:e.className,textContent:e.textContent})})),window.localStorage.setItem("saveGameObj",JSON.stringify(n))}static showResults(){const e=d.render();document.body.append(e)}}class u{static isFlagMode=!1;constructor(e,t,n,s=0){this.values=[e,t,n,s]}renderInfos(){u.isFlagMode=!1;const e=document.createElement("div");return e.className="infos",["Mines left","Time","Moves","Flags","Flag"].forEach(((t,n)=>{const s=u.renderInfo(t,this.values[n]);e.append(s)})),e}static renderInfo(e,t){const n=document.createElement("div");if(n.className="info","Flag"===e){const e=u.renderFlagButton();n.append(e)}else{n.textContent=`${e}: `;const s=document.createElement("span");s.textContent=t,s.id=function(e){return e.toLowerCase().split(" ").join("-")}(e),"Time"===e?n.append(s,"s"):n.append(s)}return n}static renderFlagButton(){const e=document.createElement("button");return e.className="button button_flag",e.addEventListener("click",u.toggleFlagMode),e}static toggleFlagMode(e){l.isMuted||new Audio(i).play(),e.target.classList.toggle("button_flag-active"),u.isFlagMode=!u.isFlagMode}static renderMenuButton(){const e=document.createElement("button");return e.className="button button_menu",e.textContent="Menu",e.addEventListener("click",u.showMenu),e}static showMenu(){const e=l.renderBackground();document.querySelector(".main-container").append(e),document.querySelector(".controls-wrapper").classList.add("controls-wrapper_active")}}class m{constructor(e=10,t=0,n=0,s=0){this.value=[e,t,n,s]}renderHeader(){const e=document.createElement("header");e.className="header";const n=t.renderContainer();n.classList.add("header-container");const s=new u(...this.value).renderInfos(),a=u.renderMenuButton();return n.append(a,s),e.append(n),e}}var h=e.p+"assets/click.mp3",f=e.p+"assets/win.mp3",g=e.p+"assets/lose.mp3",p=e.p+"assets/flag.mp3";class v extends r{static render(e){const t=r.renderModal(),n=v.renderContent(e),s=v.renderBackButton();return s.addEventListener("click",(()=>t.remove())),t.querySelector(".modal__body").append(n,s),t}static renderContent(e){const t=document.createElement("div");t.className="message-body";const{win:n}=e;if(n){const n=document.createElement("h2");n.textContent=`Hooray! You found all mines in ${e.time} seconds and ${e.moves} moves!`,t.append(n)}else{const e=document.createElement("h2");e.textContent="Your life ends in a wasteland... Game over. Try again",t.append(e)}return t}static renderBackButton(){const e=document.createElement("button");return e.className="button button_back",e.textContent="Back",e}}class y{constructor(e="easy",t=0,n={}){this.difficulty=e,this.mines=this.getMinesCount(t),this.size=this.getSizeFromDifficulty(),this.savedField=n.cells||[],this.isGameOver=!1,this.isPause=!1,window.addEventListener("timerPause",this.pauseTimer),window.addEventListener("timerGo",this.goTimer)}pauseTimer=()=>{this.isPause=!0};goTimer=()=>{this.isPause=!1};getSizeFromDifficulty(){switch(this.difficulty){case"easy":return 10;case"medium":default:return 15;case"hard":return 25}}renderField=()=>{const e=document.createElement("div");if(this.field=e,e.className=`field field_${this.difficulty}`,e.id="field",0===this.savedField.length)for(let t=0;t<this.size*this.size;t+=1){const n=y.renderCell(t);e.append(n)}else this.renderFieldFromSave(e),this.checkGameAvailable();return e.addEventListener("click",this.fieldClickHandler),e};renderFieldFromSave(e){this.savedField.forEach((t=>{const n=y.renderCellFromSave(t);this.getMinesArrayFromSave(n),e.append(n)}))}putResultToList(){const[e,t]=a(),n=this.minesArray.length,i=s(this.field.className),r=new CustomEvent("saveToResults",{detail:{difficulty:i,time:e,moves:t,mines:n}});window.dispatchEvent(r)}getMinesArrayFromSave(e){this.minesArray||(this.minesArray=[]),"B"===e.textContent&&this.minesArray.push(Number(e.id))}static renderCellFromSave({id:e,status:t,textContent:n,coord:s,className:a}){const i=document.createElement("div");return i.id=e,i.className=a,i.setAttribute("data-status",t),i.setAttribute("data-coord",s),i.textContent=n,i}static renderCell(e){const t=document.createElement("div");return t.id=e,t.className="cell",t.setAttribute("data-status","hidden"),t}fieldClickHandler=e=>{if(e.target.classList.contains("cell")){const t=e.target;this.handleCellClick(t)}};handleCellClick(e){if(!this.isGameOver){if(this.firstCell||this.handleFirstClick(e),u.isFlagMode&&"opened"!==e.dataset.status)return"flag"===e.dataset.status?(e.dataset.status="hidden",y.changeMinesLeftCount("+"),y.changeFlagsCount("-")):(e.dataset.status="flag",y.changeMinesLeftCount("-"),y.changeFlagsCount("+")),void y.addClick();if("opened"!==e.dataset.status&&"flag"!==e.dataset.status){if("B"===e.textContent)return y.addClick(),e.setAttribute("data-status","bomb"),e.classList.remove("mines-hidden"),this.isGameOver=!0,void this.openBombMines();y.addClick(),this.openCell(e),this.checkWin()}}}openCell=e=>{if(e.dataset.status="opened",e.classList.remove("mines-hidden"),"0"===e.textContent)for(let t=-1;t<=1;t+=1)for(let n=-1;n<=1;n+=1){const[s,a]=e.dataset.coord.split("-").map((e=>+e));if(!(a+n<0||s+t<0||a+n>=this.size||s+t>=this.size)){const e=a+n+this.size*(s+t),i=document.getElementById(e);"hidden"===i.dataset.status&&this.openCell(i)}}};openBombMines(){clearInterval(this.timerId),this.minesArray.forEach((e=>{const t=document.getElementById(e);t&&(t.dataset.status="bomb",t.classList.remove("mines-hidden"))})),l.isMuted||new Audio(g).play();const e=v.render({win:!1});document.body.append(e)}handleFirstClick(e){this.firstCell=e.id,this.startTimer(),0===this.savedField.length&&(this.countAdjacentMines(),this.insertNumbers())}generateMinesArray(){const e=[];for(;e.length<this.mines;){const t=Math.floor(Math.random()*this.size**2);e.includes(t)||t===Number(this.firstCell)||e.push(t)}this.minesArray=e}getMinesCount(e){return 0===e?10===this.size?5:(this.size,30):e}insertNumbers=()=>{const e=this.field.querySelectorAll(".cell");for(let t=0;t<this.size;t+=1)for(let n=0;n<this.size;n+=1){const s=n+this.size*t,a=this.fieldMatrix[t][n];e[s].textContent=a,e[s].setAttribute("data-coord",`${t}-${n}`),this.fieldMatrix[t][n]>0&&e[s].classList.add(`mines-${a}`),e[s].classList.add("mines-hidden")}};generateFieldMatrix(){const e=[];this.generateMinesArray();for(let t=0;t<this.size;t+=1){const t=new Array(this.size).fill(0);e.push(t)}return e}countAdjacentMines(){this.fieldMatrix=this.generateFieldMatrix();for(let e=0;e<this.size;e+=1)for(let t=0;t<this.size;t+=1){const n=t+this.size*e;if(this.minesArray.includes(n))this.fieldMatrix[e][t]="B";else{const n=this.countMinesNearCell(t,e);this.fieldMatrix[e][t]=n}}}countMinesNearCell(e,t){let n=0;for(let s=-1;s<=1;s+=1)for(let a=-1;a<=1;a+=1)if(!(e+s<0||t+a<0||e+s>=this.size||t+a>=this.size)){const i=e+s+this.size*(t+a);this.minesArray.includes(i)&&(n+=1)}return n}static addClick(){if(!u.isFlagMode){const e=document.getElementById("moves"),t=Number(e.textContent);e.textContent=t+1}l.isMuted||(u.isFlagMode?new Audio(p).play():new Audio(h).play())}startTimer(){const e=document.getElementById("time");this.timerId=setInterval((()=>{if(!this.isPause){const t=Number(e.textContent);e.textContent=t+1}}),1e3)}checkGameAvailable(){const e=this.field.querySelectorAll('.cell[data-status="hidden"]').length,t=this.field.querySelectorAll('.cell[data-status="flag"]').length,n=this.minesArray.length;this.field.querySelectorAll('.cell[data-status="bomb"]').length!==n&&e+t!==n||(this.isGameOver=!0)}static changeMinesLeftCount(e){const t=document.getElementById("mines-left");t.textContent="+"===e?Number(t.textContent)+1:Number(t.textContent)-1}static changeFlagsCount(e){const t=document.getElementById("flags");t.textContent="+"===e?Number(t.textContent)+1:Number(t.textContent)-1}checkWin(){if(this.field.querySelectorAll('.cell[data-status="hidden"]').length+this.field.querySelectorAll('.cell[data-status="flag"]').length===this.minesArray.length){this.isGameOver=!0,clearInterval(this.timerId),l.isMuted||new Audio(f).play();const[e,t]=a(),n=v.render({win:!0,time:e,moves:t});document.body.append(n),this.putResultToList()}}}class b{static renderMain(e,n,s){const a=document.createElement("main"),i=t.renderContainer();i.classList.add("main-container");const r=new y(e,n,s).renderField(),o=l.renderControls();return i.append(o,r),a.append(i),a}}class C{constructor(e,t,n){this.mines=e,this.difficulty=t,this.savedGame=n,this.time=n.time,this.moves=n.moves,this.flags=C.countFlags(n.cells)}static countFlags(e){return e&&0!==e.length?e.reduce(((e,t)=>"flag"===t.status?e+1:e),0):0}start(){const e=new m(Number(this.mines)-this.savedGame.minesLeft||10,this.time,this.moves,this.flags).renderHeader();document.body.append(e);const t=b.renderMain(this.difficulty,this.mines,this.savedGame);document.body.append(t),window.addEventListener("restart",C.restartGame),window.addEventListener("newGame",C.startNewGame),window.addEventListener("saveToResults",C.saveToResults)}static restartGame(e){document.body.innerHTML="";const[t,n]=e.detail,s=new m(n,0,0).renderHeader(),a=b.renderMain(t,n);document.body.append(s,a)}static startNewGame(e){document.body.innerHTML="";const[t,n]=e.detail,s=new m(n,0,0).renderHeader(),a=b.renderMain(t,n);document.body.append(s,a)}static saveToResults(e){const t=JSON.parse(localStorage.getItem("savedResults")||"[]"),{time:n,mines:s,difficulty:a,moves:i}=e.detail;t.length>=10&&t.shift(),t.push({time:n,mines:s,difficulty:a,moves:i}),localStorage.setItem("savedResults",JSON.stringify(t))}}class w{constructor(){this.mines=w.getMinesCount()||10,this.difficulty=w.getDifficulty()||"easy",this.savedGame=w.getGameFromLocalStorage()}start(){w.applyTheme(),new C(this.mines,this.difficulty,this.savedGame).start()}static getGameFromLocalStorage(){const e=window.localStorage.getItem("saveGameObj");return e?JSON.parse(e):{}}static getDifficulty(){return window.localStorage.getItem("difficultyValue")}static getMinesCount(){return window.localStorage.getItem("minesCountValue")}static applyTheme(){"true"===window.localStorage.getItem("isLightTheme")&&document.body.classList.add("light-theme")}}(new w).start()}();